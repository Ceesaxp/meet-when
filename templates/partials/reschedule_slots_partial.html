{{define "reschedule_slots_partial.html"}}
<div class="slots-wrapper">
    {{if .Slots}}
    <div class="date-navigation">
        <button type="button" onclick="navigateWeek(-1)" class="btn-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                <polyline points="15 18 9 12 15 6"/>
            </svg>
        </button>
        <span class="date-range">{{formatDate .StartDate}} - {{formatDate .EndDate}}</span>
        <button type="button" onclick="navigateWeek(1)" class="btn-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                <polyline points="9 18 15 12 9 6"/>
            </svg>
        </button>
    </div>

    <div class="slots-grid">
        {{range $date, $slots := .Slots}}
        <div class="date-column">
            <h4 class="date-header">{{formatDate (index $slots 0).Start}}</h4>
            <div class="time-slots">
                {{range $slots}}
                <button type="button" class="time-slot"
                        onclick="selectSlot('{{.Start.Format "2006-01-02T15:04:05Z07:00"}}', '{{formatDateTime .Start}}')">
                    {{formatTime .Start}}
                </button>
                {{end}}
            </div>
        </div>
        {{end}}
    </div>
    {{else}}
    <div class="no-slots">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="48" height="48">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
            <line x1="9" y1="16" x2="15" y2="16"/>
        </svg>
        <p>No available times for this week.</p>
        <button type="button" onclick="navigateWeek(1)" class="btn btn-outline">
            Check next week
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                <polyline points="9 18 15 12 9 6"/>
            </svg>
        </button>
    </div>
    {{end}}
</div>

<script>
var currentStartDate = '{{.StartDate.Format "2006-01-02"}}';
var rescheduleToken = '{{.Token}}';

function navigateWeek(direction) {
    var date = new Date(currentStartDate);
    date.setDate(date.getDate() + (direction * 7));
    var newDate = date.toISOString().split('T')[0];
    var tz = document.getElementById('timezone').value;
    var duration = getSelectedDuration();
    htmx.ajax('GET', '/booking/' + rescheduleToken + '/reschedule/slots?date=' + newDate + '&timezone=' + tz + '&duration=' + duration, {target: '#slots-container'});
}
</script>
{{end}}
