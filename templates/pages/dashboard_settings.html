{{define "dashboard_settings.html"}}
{{template "dashboard" .}}
{{end}}

{{define "content"}}
<div class="page-header">
    <h1>Settings</h1>
</div>

<div class="section">
    <h2>Profile</h2>
    <form method="POST" action="/dashboard/settings" class="form">
        <input type="hidden" name="_method" value="PUT">

        <div class="form-group">
            <label for="name">Name</label>
            <input type="text" id="name" name="name" required value="{{.Host.Name}}">
        </div>

        <div class="form-group">
            <label for="slug">URL Slug</label>
            <input type="text" id="slug" name="slug" required pattern="[a-z0-9-]+" value="{{.Host.Slug}}">
            <small>Your booking URL: {{$.BaseURL}}/m/{{.Tenant.Slug}}/<strong>{{.Host.Slug}}</strong></small>
        </div>

        <div class="form-group">
            <label for="timezone-search">Timezone</label>
            <div class="tz-picker-container">
                <input type="text" id="timezone-search" class="tz-picker-input"
                       placeholder="Search for a timezone..." autocomplete="off">
                <input type="hidden" id="timezone" name="timezone" value="{{.Host.Timezone}}">
                <div id="timezone-results" class="tz-picker-dropdown" style="display: none;"></div>
            </div>
        </div>

        <button type="submit" class="btn btn-primary">Save Profile</button>
    </form>
</div>

<div class="section">
    <h2>Working Hours</h2>
    <p>Set your default availability. These can be overridden per meeting type.</p>

    <form method="POST" action="/dashboard/settings/working-hours" class="form">
        <input type="hidden" name="_method" value="PUT">

        <table class="working-hours-table">
            <thead>
                <tr>
                    <th>Day</th>
                    <th>Enabled</th>
                    <th>Start</th>
                    <th>End</th>
                </tr>
            </thead>
            <tbody>
                {{range $i, $day := .Data.DayNames}}
                {{$hours := index $.Data.WorkingHours $i}}
                <tr>
                    <td>{{$day}}</td>
                    <td>
                        <input type="checkbox" name="day_{{$i}}_enabled"
                               {{if $hours}}{{if (index $hours 0).IsEnabled}}checked{{end}}{{end}}>
                    </td>
                    <td>
                        <input type="time" name="day_{{$i}}_start"
                               value="{{if $hours}}{{(index $hours 0).StartTime}}{{else}}09:00{{end}}">
                    </td>
                    <td>
                        <input type="time" name="day_{{$i}}_end"
                               value="{{if $hours}}{{(index $hours 0).EndTime}}{{else}}17:00{{end}}">
                    </td>
                </tr>
                {{end}}
            </tbody>
        </table>

        <button type="submit" class="btn btn-primary">Save Working Hours</button>
    </form>
</div>

<script src="/static/js/timezone-picker.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    var picker = new TimezonePicker({
        inputId: 'timezone-search',
        hiddenInputId: 'timezone',
        dropdownId: 'timezone-results',
        initialValue: '{{.Host.Timezone}}',
        onSelect: function(tz) {
            console.log('Selected timezone:', tz.id);
        }
    });
    picker.init();
});
</script>
{{end}}
