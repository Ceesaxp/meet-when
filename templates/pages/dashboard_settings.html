{{define "dashboard_settings.html"}}
{{template "dashboard" .}}
{{end}}

{{define "content"}}
<div class="page-header">
    <h1 class="page-title">Settings</h1>
</div>

<section class="settings-section">
    <div class="section-header">
        <h2 class="section-title">Profile</h2>
        <p class="section-subtitle">Your personal information</p>
    </div>

    <form method="POST" action="/dashboard/settings">
        <input type="hidden" name="_method" value="PUT">

        <div class="form-row">
            <div class="form-group">
                <label class="form-label" for="name">Name</label>
                <input type="text" id="name" name="name" class="form-input" required value="{{.Host.Name}}">
            </div>
            <div class="form-group">
                <label class="form-label" for="slug">Booking URL</label>
                <input type="text" id="slug" name="slug" class="form-input" required pattern="[a-z0-9-]+" value="{{.Host.Slug}}">
                <p class="form-hint">Your booking page: {{$.BaseURL}}/m/{{.Tenant.Slug}}/{{.Host.Slug}}</p>
            </div>
        </div>

        <div class="section-actions">
            <button type="submit" class="btn btn-primary">Save Changes</button>
        </div>
    </form>
</section>

<section class="settings-section">
    <div class="section-header">
        <h2 class="section-title">Availability</h2>
        <p class="section-subtitle">Set your default working hours</p>
    </div>

    <form method="POST" action="/dashboard/settings/working-hours">
        <input type="hidden" name="_method" value="PUT">

        <div class="form-group">
            <label class="form-label" for="timezone-search">Timezone</label>
            <div class="tz-picker-container">
                <input type="text" id="timezone-search" class="form-input tz-picker-input"
                       placeholder="Search for a timezone..." autocomplete="off">
                <input type="hidden" id="timezone" name="timezone" value="{{.Host.Timezone}}">
                <div id="timezone-results" class="tz-picker-dropdown" style="display: none;"></div>
            </div>
        </div>

        <div class="availability-grid">
            {{range $i, $day := .Data.DayNames}}
            {{$hours := index $.Data.WorkingHours $i}}
            <div class="availability-row">
                <div class="day-toggle">
                    <input type="checkbox" class="day-checkbox" name="day_{{$i}}_enabled"
                           {{if $hours}}{{if (index $hours 0).IsEnabled}}checked{{end}}{{end}}>
                    <span class="day-name">{{$day}}</span>
                </div>
                <div class="time-range">
                    <input type="time" class="time-input" name="day_{{$i}}_start"
                           value="{{if $hours}}{{(index $hours 0).StartTime}}{{else}}09:00{{end}}">
                    <span class="time-separator">to</span>
                    <input type="time" class="time-input" name="day_{{$i}}_end"
                           value="{{if $hours}}{{(index $hours 0).EndTime}}{{else}}17:00{{end}}">
                </div>
            </div>
            {{end}}
        </div>

        <div class="section-actions">
            <button type="submit" class="btn btn-primary">Save Changes</button>
        </div>
    </form>
</section>

<script src="/static/js/timezone-picker.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    var picker = new TimezonePicker({
        inputId: 'timezone-search',
        hiddenInputId: 'timezone',
        dropdownId: 'timezone-results',
        initialValue: '{{.Host.Timezone}}',
        onSelect: function(tz) {
            console.log('Selected timezone:', tz.id);
        }
    });
    picker.init();
});
</script>
{{end}}
