{{define "dashboard_home.html"}}
{{template "dashboard" .}}
{{end}}

{{define "content"}}
<div class="page-header">
    <div>
        <h1 class="page-title">Dashboard</h1>
        <p class="page-subtitle">Welcome back, {{.Host.Name}}</p>
    </div>
</div>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-label">Pending Bookings</div>
        <div class="stat-value">{{.Data.PendingCount}}</div>
        {{if gt .Data.PendingCount 0}}
        <a href="/dashboard/bookings?filter=pending" class="stat-link">Review now &rarr;</a>
        {{else}}
        <span class="stat-link-muted">All caught up</span>
        {{end}}
    </div>
    <div class="stat-card">
        <div class="stat-label">Meeting Types</div>
        <div class="stat-value">{{len .Data.Templates}}</div>
        <a href="/dashboard/templates" class="stat-link">Manage &rarr;</a>
    </div>
    <div class="stat-card link-card">
        <div class="stat-label">Your Booking Link</div>
        <div class="link-url">{{$.BaseURL}}/m/{{.Tenant.Slug}}/{{.Host.Slug}}</div>
        <button id="copyLinkBtn" onclick="copyLink(this)" class="btn-copy">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
            </svg>
            Copy Link
        </button>
    </div>
</div>

<section class="section">
    <div class="section-header">
        <h2 class="section-title">Upcoming Bookings</h2>
        <a href="/dashboard/bookings" class="section-link">View all &rarr;</a>
    </div>
    {{if .Data.Bookings}}
    <div class="table-container">
        <table class="table">
            <thead>
                <tr>
                    <th>Date & Time</th>
                    <th>Guest</th>
                    <th>Meeting Type</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {{range .Data.Bookings}}
                <tr>
                    <td>{{formatDateTime .StartTime}}</td>
                    <td>
                        <div class="guest-info">
                            <span class="guest-name">{{.InviteeName}}</span>
                            <span class="guest-email">{{.InviteeEmail}}</span>
                        </div>
                    </td>
                    <td>{{.Duration}} min</td>
                    <td><span class="badge badge-{{.Status}}">{{.Status}}</span></td>
                    <td>
                        <div class="table-actions">
                            {{if eq .Status "pending"}}
                            <form action="/dashboard/bookings/{{.ID}}/approve" method="POST" style="display:inline">
                                <button type="submit" class="btn-sm btn-approve">Approve</button>
                            </form>
                            {{end}}
                            {{if or (eq .Status "pending") (eq .Status "confirmed")}}
                            <form action="/dashboard/bookings/{{.ID}}/cancel" method="POST" style="display:inline">
                                <button type="submit" class="btn-sm btn-cancel">Cancel</button>
                            </form>
                            {{end}}
                        </div>
                    </td>
                </tr>
                {{end}}
            </tbody>
        </table>
    </div>
    {{else}}
    <div class="table-container">
        <div class="empty-state">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
            <h3>No bookings yet</h3>
            <p>Share your booking link to get started!</p>
        </div>
    </div>
    {{end}}
</section>

<script>
function copyLink(btn) {
    navigator.clipboard.writeText('{{$.BaseURL}}/m/{{.Tenant.Slug}}/{{.Host.Slug}}').then(function() {
        var originalText = btn.innerHTML;
        btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><polyline points="20 6 9 17 4 12"/></svg> Copied!';
        btn.classList.add('btn-copied');
        setTimeout(function() {
            btn.innerHTML = originalText;
            btn.classList.remove('btn-copied');
        }, 2000);
    }).catch(function(err) {
        console.error('Failed to copy: ', err);
    });
}
</script>
{{end}}
